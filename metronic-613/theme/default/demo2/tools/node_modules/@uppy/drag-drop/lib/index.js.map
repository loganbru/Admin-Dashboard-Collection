{"version":3,"sources":["index.js"],"names":["require","Plugin","Translator","toArray","isDragDropSupported","getDroppedFiles","h","module","exports","uppy","opts","type","id","title","defaultLocale","strings","dropHereOr","browse","defaultOpts","target","inputName","width","height","note","removeDragOverClassTimeout","i18nInit","onInputChange","bind","handleDragOver","handleDragLeave","handleDrop","addFiles","render","setOptions","newOpts","translator","locale","i18n","translate","i18nArray","translateArray","setPluginState","files","descriptors","map","file","source","name","data","meta","relativePath","err","log","event","value","dropCategory","preventDefault","stopPropagation","clearTimeout","isDraggingOver","logDropError","error","dataTransfer","then","dropEffect","setTimeout","renderHiddenFileInput","restrictions","ref","fileInputRef","maxNumberOfFiles","allowedFileTypes","renderArrowSvg","renderLabel","renderNote","state","dragDropClass","getPluginState","dragDropStyle","click","install","mount","uninstall","unmount","VERSION"],"mappings":"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","sourcesContent":["const { Plugin } = require('@uppy/core')\nconst Translator = require('@uppy/utils/lib/Translator')\nconst toArray = require('@uppy/utils/lib/toArray')\nconst isDragDropSupported = require('@uppy/utils/lib/isDragDropSupported')\nconst getDroppedFiles = require('@uppy/utils/lib/getDroppedFiles')\nconst { h } = require('preact')\n\n/**\n * Drag & Drop plugin\n *\n */\nmodule.exports = class DragDrop extends Plugin {\n  static VERSION = require('../package.json').version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'DragDrop'\n    this.title = 'Drag & Drop'\n\n    this.defaultLocale = {\n      strings: {\n        dropHereOr: 'Drop files here or %{browse}',\n        browse: 'browse'\n      }\n    }\n\n    // Default options\n    const defaultOpts = {\n      target: null,\n      inputName: 'files[]',\n      width: '100%',\n      height: '100%',\n      note: null\n    }\n\n    // Merge default options with the ones set by user\n    this.opts = { ...defaultOpts, ...opts }\n\n    // Check for browser dragDrop support\n    this.isDragDropSupported = isDragDropSupported()\n    this.removeDragOverClassTimeout = null\n\n    this.i18nInit()\n\n    // Bind `this` to class methods\n    this.onInputChange = this.onInputChange.bind(this)\n    this.handleDragOver = this.handleDragOver.bind(this)\n    this.handleDragLeave = this.handleDragLeave.bind(this)\n    this.handleDrop = this.handleDrop.bind(this)\n    this.addFiles = this.addFiles.bind(this)\n    this.render = this.render.bind(this)\n  }\n\n  setOptions (newOpts) {\n    super.setOptions(newOpts)\n    this.i18nInit()\n  }\n\n  i18nInit () {\n    this.translator = new Translator([this.defaultLocale, this.uppy.locale, this.opts.locale])\n    this.i18n = this.translator.translate.bind(this.translator)\n    this.i18nArray = this.translator.translateArray.bind(this.translator)\n    this.setPluginState() // so that UI re-renders and we see the updated locale\n  }\n\n  addFiles (files) {\n    const descriptors = files.map((file) => ({\n      source: this.id,\n      name: file.name,\n      type: file.type,\n      data: file,\n      meta: {\n        // path of the file relative to the ancestor directory the user selected.\n        // e.g. 'docs/Old Prague/airbnb.pdf'\n        relativePath: file.relativePath || null\n      }\n    }))\n\n    try {\n      this.uppy.addFiles(descriptors)\n    } catch (err) {\n      this.uppy.log(err)\n    }\n  }\n\n  onInputChange (event) {\n    this.uppy.log('[DragDrop] Files selected through input')\n    const files = toArray(event.target.files)\n    this.addFiles(files)\n\n    // We clear the input after a file is selected, because otherwise\n    // change event is not fired in Chrome and Safari when a file\n    // with the same name is selected.\n    // ___Why not use value=\"\" on <input/> instead?\n    //    Because if we use that method of clearing the input,\n    //    Chrome will not trigger change if we drop the same file twice (Issue #768).\n    event.target.value = null\n  }\n\n  handleDrop (event, dropCategory) {\n    event.preventDefault()\n    event.stopPropagation()\n    clearTimeout(this.removeDragOverClassTimeout)\n\n    // 2. Remove dragover class\n    this.setPluginState({ isDraggingOver: false })\n\n    // 3. Add all dropped files\n    this.uppy.log('[DragDrop] Files were dropped')\n    const logDropError = (error) => {\n      this.uppy.log(error, 'error')\n    }\n    getDroppedFiles(event.dataTransfer, { logDropError })\n      .then((files) => this.addFiles(files))\n  }\n\n  handleDragOver (event) {\n    event.preventDefault()\n    event.stopPropagation()\n\n    // 1. Add a small (+) icon on drop\n    // (and prevent browsers from interpreting this as files being _moved_ into the browser, https://github.com/transloadit/uppy/issues/1978)\n    event.dataTransfer.dropEffect = 'copy'\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    this.setPluginState({ isDraggingOver: true })\n  }\n\n  handleDragLeave (event) {\n    event.preventDefault()\n    event.stopPropagation()\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    // Timeout against flickering, this solution is taken from drag-drop library. Solution with 'pointer-events: none' didn't work across browsers.\n    this.removeDragOverClassTimeout = setTimeout(() => {\n      this.setPluginState({ isDraggingOver: false })\n    }, 50)\n  }\n\n  renderHiddenFileInput () {\n    const restrictions = this.uppy.opts.restrictions\n    return (\n      <input\n        class=\"uppy-DragDrop-input\"\n        type=\"file\"\n        hidden\n        ref={(ref) => { this.fileInputRef = ref }}\n        name={this.opts.inputName}\n        multiple={restrictions.maxNumberOfFiles !== 1}\n        accept={restrictions.allowedFileTypes}\n        onchange={this.onInputChange}\n      />\n    )\n  }\n\n  renderArrowSvg () {\n    return (\n      <svg aria-hidden=\"true\" focusable=\"false\" class=\"uppy-c-icon uppy-DragDrop-arrow\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\">\n        <path d=\"M11 10V0H5v10H2l6 6 6-6h-3zm0 0\" fill-rule=\"evenodd\" />\n      </svg>\n    )\n  }\n\n  renderLabel () {\n    return (\n      <div class=\"uppy-DragDrop-label\">\n        {this.i18nArray('dropHereOr', {\n          browse: <span class=\"uppy-DragDrop-browse\">{this.i18n('browse')}</span>\n        })}\n      </div>\n    )\n  }\n\n  renderNote () {\n    return (\n      <span class=\"uppy-DragDrop-note\">{this.opts.note}</span>\n    )\n  }\n\n  render (state) {\n    const dragDropClass = `uppy-Root\n      uppy-u-reset\n      uppy-DragDrop-container\n      ${this.isDragDropSupported ? 'uppy-DragDrop--isDragDropSupported' : ''}\n      ${this.getPluginState().isDraggingOver ? 'uppy-DragDrop--isDraggingOver' : ''}\n    `\n\n    const dragDropStyle = {\n      width: this.opts.width,\n      height: this.opts.height\n    }\n\n    return (\n      <button\n        type=\"button\"\n        class={dragDropClass}\n        style={dragDropStyle}\n        onClick={() => this.fileInputRef.click()}\n        onDragOver={this.handleDragOver}\n        onDragLeave={this.handleDragLeave}\n        onDrop={this.handleDrop}\n      >\n        {this.renderHiddenFileInput()}\n        <div class=\"uppy-DragDrop-inner\">\n          {this.renderArrowSvg()}\n          {this.renderLabel()}\n          {this.renderNote()}\n        </div>\n      </button>\n    )\n  }\n\n  install () {\n    this.setPluginState({\n      isDraggingOver: false\n    })\n    const target = this.opts.target\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n}\n"]}