{"version":3,"sources":["index.js"],"names":["require","Plugin","Translator","h","RequestClient","UrlUI","forEachDroppedOrPastedUrl","UrlIcon","module","exports","uppy","opts","id","title","type","icon","defaultLocale","strings","import","enterUrlToImport","failedToFetch","enterCorrectUrl","defaultOptions","i18nInit","hostname","companionUrl","Error","getMeta","bind","addFile","handleRootDrop","handleRootPaste","client","companionHeaders","serverHeaders","setOptions","newOpts","translator","locale","i18n","translate","i18nArray","translateArray","setPluginState","getFileNameFromUrl","url","substring","lastIndexOf","checkIfCorrectURL","protocol","match","addProtocolToURL","protocolRegex","defaultProtocol","test","post","then","res","error","log","info","meta","tagFile","source","name","data","size","isRemote","body","remote","fileId","providerOptions","err","isRestriction","catch","message","details","e","dataTransfer","clipboardData","render","state","install","target","mount","uninstall","unmount","VERSION"],"mappings":"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","sourcesContent":["const { Plugin } = require('@uppy/core')\nconst Translator = require('@uppy/utils/lib/Translator')\nconst { h } = require('preact')\nconst { RequestClient } = require('@uppy/companion-client')\nconst UrlUI = require('./UrlUI.js')\nconst forEachDroppedOrPastedUrl = require('./utils/forEachDroppedOrPastedUrl')\n\nfunction UrlIcon () {\n  return (\n    <svg aria-hidden=\"true\" focusable=\"false\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">\n      <g fill=\"none\" fill-rule=\"evenodd\">\n        <rect fill=\"#FF753E\" width=\"32\" height=\"32\" rx=\"16\" />\n        <path d=\"M22.788 15.389l-2.199 2.19a3.184 3.184 0 0 1-.513.437c-.806.584-1.686.876-2.638.876a4.378 4.378 0 0 1-3.519-1.752c-.22-.292-.146-.802.147-1.021.293-.22.806-.146 1.026.146.953 1.313 2.785 1.532 4.105.583a.571.571 0 0 0 .293-.292l2.199-2.189c1.1-1.167 1.1-2.992-.073-4.086a2.976 2.976 0 0 0-4.105 0l-1.246 1.24a.71.71 0 0 1-1.026 0 .703.703 0 0 1 0-1.022l1.246-1.24a4.305 4.305 0 0 1 6.083 0c1.833 1.605 1.906 4.451.22 6.13zm-7.183 5.035l-1.246 1.24a2.976 2.976 0 0 1-4.105 0c-1.172-1.094-1.172-2.991-.073-4.086l2.2-2.19.292-.291c.66-.438 1.393-.657 2.2-.584.805.146 1.465.51 1.905 1.168.22.292.733.365 1.026.146.293-.22.367-.73.147-1.022-.733-.949-1.76-1.532-2.859-1.678-1.1-.22-2.272.073-3.225.802l-.44.438-2.199 2.19c-1.686 1.75-1.612 4.524.074 6.202.88.803 1.979 1.241 3.078 1.241 1.1 0 2.199-.438 3.079-1.24l1.246-1.241a.703.703 0 0 0 0-1.022c-.294-.292-.807-.365-1.1-.073z\" fill=\"#FFF\" fill-rule=\"nonzero\" />\n      </g>\n    </svg>\n  )\n}\n\n/**\n * Url\n *\n */\nmodule.exports = class Url extends Plugin {\n  static VERSION = require('../package.json').version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.id = this.opts.id || 'Url'\n    this.title = this.opts.title || 'Link'\n    this.type = 'acquirer'\n    this.icon = () => <UrlIcon />\n\n    // Set default options and locale\n    this.defaultLocale = {\n      strings: {\n        import: 'Import',\n        enterUrlToImport: 'Enter URL to import a file',\n        failedToFetch: 'Companion failed to fetch this URL, please make sure itâ€™s correct',\n        enterCorrectUrl: 'Incorrect URL: Please make sure you are entering a direct link to a file'\n      }\n    }\n\n    const defaultOptions = {}\n\n    this.opts = { ...defaultOptions, ...opts }\n\n    this.i18nInit()\n\n    this.hostname = this.opts.companionUrl\n\n    if (!this.hostname) {\n      throw new Error('Companion hostname is required, please consult https://uppy.io/docs/companion')\n    }\n\n    // Bind all event handlers for referencability\n    this.getMeta = this.getMeta.bind(this)\n    this.addFile = this.addFile.bind(this)\n    this.handleRootDrop = this.handleRootDrop.bind(this)\n    this.handleRootPaste = this.handleRootPaste.bind(this)\n\n    this.client = new RequestClient(uppy, {\n      companionUrl: this.opts.companionUrl,\n      companionHeaders: this.opts.companionHeaders || this.opts.serverHeaders\n    })\n  }\n\n  setOptions (newOpts) {\n    super.setOptions(newOpts)\n    this.i18nInit()\n  }\n\n  i18nInit () {\n    this.translator = new Translator([this.defaultLocale, this.uppy.locale, this.opts.locale])\n    this.i18n = this.translator.translate.bind(this.translator)\n    this.i18nArray = this.translator.translateArray.bind(this.translator)\n    this.setPluginState() // so that UI re-renders and we see the updated locale\n  }\n\n  getFileNameFromUrl (url) {\n    return url.substring(url.lastIndexOf('/') + 1)\n  }\n\n  checkIfCorrectURL (url) {\n    if (!url) return false\n\n    const protocol = url.match(/^([a-z0-9]+):\\/\\//)[1]\n    if (protocol !== 'http' && protocol !== 'https') {\n      return false\n    }\n\n    return true\n  }\n\n  addProtocolToURL (url) {\n    const protocolRegex = /^[a-z0-9]+:\\/\\//\n    const defaultProtocol = 'http://'\n    if (protocolRegex.test(url)) {\n      return url\n    }\n\n    return defaultProtocol + url\n  }\n\n  getMeta (url) {\n    return this.client.post('url/meta', { url })\n      .then((res) => {\n        if (res.error) {\n          this.uppy.log('[URL] Error:')\n          this.uppy.log(res.error)\n          throw new Error('Failed to fetch the file')\n        }\n        return res\n      })\n  }\n\n  addFile (url) {\n    url = this.addProtocolToURL(url)\n    if (!this.checkIfCorrectURL(url)) {\n      this.uppy.log(`[URL] Incorrect URL entered: ${url}`)\n      this.uppy.info(this.i18n('enterCorrectUrl'), 'error', 4000)\n      return\n    }\n\n    return this.getMeta(url)\n      .then((meta) => {\n        const tagFile = {\n          source: this.id,\n          name: this.getFileNameFromUrl(url),\n          type: meta.type,\n          data: {\n            size: meta.size\n          },\n          isRemote: true,\n          body: {\n            url: url\n          },\n          remote: {\n            companionUrl: this.opts.companionUrl,\n            url: `${this.hostname}/url/get`,\n            body: {\n              fileId: url,\n              url: url\n            },\n            providerOptions: this.client.opts\n          }\n        }\n        return tagFile\n      })\n      .then((tagFile) => {\n        this.uppy.log('[Url] Adding remote file')\n        try {\n          this.uppy.addFile(tagFile)\n        } catch (err) {\n          if (!err.isRestriction) {\n            this.uppy.log(err)\n          }\n        }\n      })\n      .catch((err) => {\n        this.uppy.log(err)\n        this.uppy.info({\n          message: this.i18n('failedToFetch'),\n          details: err\n        }, 'error', 4000)\n      })\n  }\n\n  handleRootDrop (e) {\n    forEachDroppedOrPastedUrl(e.dataTransfer, 'drop', (url) => {\n      this.uppy.log(`[URL] Adding file from dropped url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  handleRootPaste (e) {\n    forEachDroppedOrPastedUrl(e.clipboardData, 'paste', (url) => {\n      this.uppy.log(`[URL] Adding file from pasted url: ${url}`)\n      this.addFile(url)\n    })\n  }\n\n  render (state) {\n    return <UrlUI i18n={this.i18n} addFile={this.addFile} />\n  }\n\n  install () {\n    const target = this.opts.target\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n}\n"]}