{"version":3,"sources":["ServiceWorker.js"],"names":["fileCache","Object","create","getCache","name","self","addEventListener","event","console","log","waitUntil","Promise","resolve","then","skipWaiting","clients","claim","sendMessageToAllClients","msg","matchAll","forEach","client","postMessage","addFile","store","file","id","data","removeFile","fileID","getFiles","type","files"],"mappings":"AAAA;AAEA,IAAMA,SAAS,GAAGC,MAAM,CAACC,MAAP,CAAc,IAAd,CAAlB;;AAEA,SAASC,QAAT,CAAmBC,IAAnB,EAAyB;AACvB,MAAI,CAACJ,SAAS,CAACI,IAAD,CAAd,EAAsB;AACpBJ,IAAAA,SAAS,CAACI,IAAD,CAAT,GAAkBH,MAAM,CAACC,MAAP,CAAc,IAAd,CAAlB;AACD;;AACD,SAAOF,SAAS,CAACI,IAAD,CAAhB;AACD;;AAEDC,IAAI,CAACC,gBAAL,CAAsB,SAAtB,EAAiC,UAACC,KAAD,EAAW;AAC1CC,EAAAA,OAAO,CAACC,GAAR,CAAY,mCAAZ;AAEAF,EAAAA,KAAK,CAACG,SAAN,CAAgBC,OAAO,CAACC,OAAR,GACbC,IADa,CACR;AAAA,WAAMR,IAAI,CAACS,WAAL,EAAN;AAAA,GADQ,CAAhB;AAED,CALD;AAOAT,IAAI,CAACC,gBAAL,CAAsB,UAAtB,EAAkC,UAACC,KAAD,EAAW;AAC3CA,EAAAA,KAAK,CAACG,SAAN,CAAgBL,IAAI,CAACU,OAAL,CAAaC,KAAb,EAAhB;AACD,CAFD;;AAIA,SAASC,uBAAT,CAAkCC,GAAlC,EAAuC;AACrCH,EAAAA,OAAO,CAACI,QAAR,GAAmBN,IAAnB,CAAwB,UAACE,OAAD,EAAa;AACnCA,IAAAA,OAAO,CAACK,OAAR,CAAgB,UAACC,MAAD,EAAY;AAC1BA,MAAAA,MAAM,CAACC,WAAP,CAAmBJ,GAAnB;AACD,KAFD;AAGD,GAJD;AAKD;;AAED,SAASK,OAAT,CAAkBC,KAAlB,EAAyBC,IAAzB,EAA+B;AAC7BtB,EAAAA,QAAQ,CAACqB,KAAD,CAAR,CAAgBC,IAAI,CAACC,EAArB,IAA2BD,IAAI,CAACE,IAAhC;AACAnB,EAAAA,OAAO,CAACC,GAAR,CAAY,0CAAZ,EAAwDgB,IAAI,CAACE,IAA7D;AACD;;AAED,SAASC,UAAT,CAAqBJ,KAArB,EAA4BK,MAA5B,EAAoC;AAClC,SAAO1B,QAAQ,CAACqB,KAAD,CAAR,CAAgBK,MAAhB,CAAP;AACArB,EAAAA,OAAO,CAACC,GAAR,CAAY,8CAAZ,EAA4DoB,MAA5D;AACD;;AAED,SAASC,QAAT,CAAmBN,KAAnB,EAA0B;AACxBP,EAAAA,uBAAuB,CAAC;AACtBc,IAAAA,IAAI,EAAE,gBADgB;AAEtBP,IAAAA,KAAK,EAAEA,KAFe;AAGtBQ,IAAAA,KAAK,EAAE7B,QAAQ,CAACqB,KAAD;AAHO,GAAD,CAAvB;AAKD;;AAEDnB,IAAI,CAACC,gBAAL,CAAsB,SAAtB,EAAiC,UAACC,KAAD,EAAW;AAC1C,UAAQA,KAAK,CAACoB,IAAN,CAAWI,IAAnB;AACE,SAAK,eAAL;AACER,MAAAA,OAAO,CAAChB,KAAK,CAACoB,IAAN,CAAWH,KAAZ,EAAmBjB,KAAK,CAACoB,IAAN,CAAWF,IAA9B,CAAP;AACA;;AACF,SAAK,kBAAL;AACEG,MAAAA,UAAU,CAACrB,KAAK,CAACoB,IAAN,CAAWH,KAAZ,EAAmBjB,KAAK,CAACoB,IAAN,CAAWE,MAA9B,CAAV;AACA;;AACF,SAAK,gBAAL;AACEC,MAAAA,QAAQ,CAACvB,KAAK,CAACoB,IAAN,CAAWH,KAAZ,CAAR;AACA;AATJ;AAWD,CAZD","sourcesContent":["/* globals clients */\n\nconst fileCache = Object.create(null)\n\nfunction getCache (name) {\n  if (!fileCache[name]) {\n    fileCache[name] = Object.create(null)\n  }\n  return fileCache[name]\n}\n\nself.addEventListener('install', (event) => {\n  console.log('Installing Uppy Service Worker...')\n\n  event.waitUntil(Promise.resolve()\n    .then(() => self.skipWaiting()))\n})\n\nself.addEventListener('activate', (event) => {\n  event.waitUntil(self.clients.claim())\n})\n\nfunction sendMessageToAllClients (msg) {\n  clients.matchAll().then((clients) => {\n    clients.forEach((client) => {\n      client.postMessage(msg)\n    })\n  })\n}\n\nfunction addFile (store, file) {\n  getCache(store)[file.id] = file.data\n  console.log('Added file blob to service worker cache:', file.data)\n}\n\nfunction removeFile (store, fileID) {\n  delete getCache(store)[fileID]\n  console.log('Removed file blob from service worker cache:', fileID)\n}\n\nfunction getFiles (store) {\n  sendMessageToAllClients({\n    type: 'uppy/ALL_FILES',\n    store: store,\n    files: getCache(store)\n  })\n}\n\nself.addEventListener('message', (event) => {\n  switch (event.data.type) {\n    case 'uppy/ADD_FILE':\n      addFile(event.data.store, event.data.file)\n      break\n    case 'uppy/REMOVE_FILE':\n      removeFile(event.data.store, event.data.fileID)\n      break\n    case 'uppy/GET_FILES':\n      getFiles(event.data.store)\n      break\n  }\n})\n"]}